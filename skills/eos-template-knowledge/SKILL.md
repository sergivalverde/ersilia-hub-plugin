---
name: eos-template-knowledge
description: >
  Knowledge base for the Ersilia Model Hub eos-template format. Use when the user asks about
  "incorporating a model into Ersilia", "eos-template", "Ersilia Model Hub model wrapper",
  "model contribution to Ersilia", or when working with eosXXXX model repositories.
version: 1.0.0
---

# Ersilia Model Hub — eos-template Reference

The Ersilia Model Hub wraps published ML models into a standardized format so they can be fetched, served, and run via the `ersilia` CLI. Every model follows the **eos-template** structure.

## Repository Structure

```
<model-id>/                          # e.g. eos4e40/
├── model/
│   ├── checkpoints/                 # Pre-trained weights (.pt, .h5, .pkl, .joblib, etc.)
│   │   └── model.pt
│   └── framework/
│       ├── code/
│       │   └── main.py              # CSV-in / CSV-out wrapper (MANDATORY)
│       ├── run.sh                   # Entry point script (MANDATORY)
│       ├── examples/
│       │   ├── run_input.csv        # 3 SMILES test inputs (MANDATORY)
│       │   └── run_output.csv       # Expected outputs for those 3 inputs (MANDATORY)
│       └── columns/
│           └── run_columns.csv      # Output column metadata (MANDATORY)
├── install.yml                      # Dependency specification (MANDATORY)
├── metadata.yml                     # Model card metadata (MANDATORY)
├── Dockerfile                       # Auto-generated by CI, do not create manually
├── LICENSE
└── README.md                        # Auto-generated from metadata, do not edit
```

## main.py Contract

The core wrapper script. It must:

- Accept two positional arguments: `sys.argv[1]` = input CSV path, `sys.argv[2]` = output CSV path
- Read input CSV (first column after header, typically SMILES strings)
- Run the model inference
- Write output CSV with prediction columns (NO input/smiles/key columns in output)
- Guarantee `len(input_rows) == len(output_rows)`

### Template Pattern

```python
import os
import csv
import sys

# Parse arguments
input_file = sys.argv[1]
output_file = sys.argv[2]

# Paths
root = os.path.dirname(os.path.abspath(__file__))
checkpoints_dir = os.path.join(root, "..", "..", "checkpoints")

# Read input
with open(input_file, "r") as f:
    reader = csv.reader(f)
    next(reader)  # skip header
    smiles_list = [r[0] for r in reader]

# Run model
outputs = my_model(smiles_list)  # replace with actual inference call

# Verify
assert len(smiles_list) == len(outputs)

# Write output
with open(output_file, "w") as f:
    writer = csv.writer(f)
    writer.writerow(["prediction_column"])  # header matching run_columns.csv
    for o in outputs:
        writer.writerow([o])
```

### Common Inference Patterns

**Pattern A — Direct import** (source code copied into `code/`):
```python
sys.path.append(os.path.join(root, "src"))
from model import predict
outputs = predict(smiles_list)
```

**Pattern B — Checkpoint loading** (PyTorch/TF/sklearn):
```python
import torch
model = torch.load(os.path.join(checkpoints_dir, "model.pt"), map_location="cpu")
model.eval()
```

**Pattern C — Library call** (pip-installable model):
```python
from biosynfoni import Biosynfoni
from rdkit import Chem
fps = [Biosynfoni(Chem.MolFromSmiles(smi)).fingerprint for smi in smiles_list]
```

## run.sh Contract

Always exactly:
```bash
python $1/code/main.py $2 $3
```
Where `$1` = framework directory path, `$2` = input CSV, `$3` = output CSV.

## install.yml Format

```yaml
python: "3.10"
commands:
    - ["pip", "library-name", "version"]
    - ["pip", "library-name", "version", "--index-url", "URL"]
    - ["pip", "git+https://github.com/org/repo.git@commit"]
    - ["conda", "library-name", "version", "channel"]
    - "any bash command as a string"
```

Rules:
- Python version: one of 3.8, 3.9, 3.10, 3.11, 3.12
- Always pin versions for reproducibility
- Use conda for compiled packages (rdkit, numpy, scipy, pytorch)
- Use pip for pure-Python packages
- Common conda channels: default, conda-forge, pytorch

## metadata.yml Format

```yaml
Identifier: eos0xxx
Slug: short-lowercase-name
Status: In progress
Title: Short model title (10-300 chars)
Description: |
  Detailed description of what the model does, how it works,
  and what it was trained on. Minimum 200 characters.
  Must differ from Title.
Deployment:
  - Local
Source: Local
Source Type: External
Task: Annotation
Subtask: Activity prediction
Input:
  - Compound
Input Dimension: 1
Output:
  - Score
Output Dimension: 1
Output Consistency: Fixed
Interpretation: |
  How to interpret the model output (10-300 chars).
Tag:
  - Antimicrobial activity
  - E.coli
Biomedical Area:
  - Antimicrobial resistance
Target Organism:
  - Escherichia coli
Publication Type: Peer reviewed
Publication Year: 2025
Publication: https://doi.org/...
Source Code: https://github.com/...
License: MIT
```

## Valid Metadata Vocabulary

### Status
Test, In maintenance, In progress, Ready, Archived

### Task
Representation, Annotation, Sampling

### Subtask
Featurization, Projection, Property calculation or prediction, Activity prediction, Similarity search, Generation

### Input
Compound, Protein, Text

### Output
Compound, Score, Value, Text

### Output Consistency
Fixed, Variable

### Biomedical Area
Any, ADMET, Antimicrobial resistance, Malaria, Tuberculosis, COVID-19, Gonorrhea, Cancer, Mycetoma, AIDS, Schistosomiasis, Hepatitis, Alzheimer, Chagas, Cryptosporidiosis, Leprosy

### Publication Type
Peer reviewed, Preprint, Other

### Source
Local, Online

### Source Type
External, Replicated, Internal

### Deployment
Local, Online

### License
MIT, GPL-3.0-only, GPL-3.0-or-later, LGPL-3.0-only, LGPL-3.0-or-later, AGPL-3.0-only, AGPL-3.0-or-later, Apache-2.0, BSD-2-Clause, BSD-3-Clause, MPL-2.0, CC-BY-3.0, CC-BY-4.0, CC0-1.0, Proprietary, None

### Tag
AIDS, Alzheimer, Cancer, Cardiotoxicity, Cytotoxicity, COVID19, Dengue, Malaria, Neglected tropical disease, Schistosomiasis, Tuberculosis, A.baumannii, E.coli, E.faecium, HBV, HIV, HDAC1, Human, K.pneumoniae, Mouse, M.tuberculosis, P.aeruginosa, P.falciparum, N.gonorrhoeae, Rat, Sars-CoV-2, S.aureus, ESKAPE, BACE, CYP450, GPCR, hERG, Fraction bound, IC50, Half-life, LogD, LogP, LogS, MIC90, Molecular weight, Papp, pKa, ADME, Antimicrobial activity, Antiviral activity, Bioactivity profile, Lipophilicity, Metabolism, Microsomal stability, Natural product, Price, Quantum properties, Permeability, Side effects, Solubility, Synthetic accessibility, Target identification, Therapeutic indication, Toxicity, ChEMBL, DrugBank, MoleculeNet, Tox21, ToxCast, TDCommons, ZINC, Chemical graph model, Chemical language model, Chemical notation, Chemical synthesis, Compound generation, Descriptor, Drug-likeness, Embedding, Fingerprint, Similarity, Biomedical text, Mycetoma, Antifungal activity, Frequent hitter

### Target Organism
Homo sapiens, Mus musculus, Rattus norvegicus, Plasmodium falciparum, Plasmodium vivax, Mycobacterium tuberculosis, Fast-acid bacteria, Fungi, Gram-negative bacteria, Gram-positive bacteria, Schistosoma mansoni, Madurella mycetomatis, Burkholderia cenocepacia, Acinetobacter baumannii, Neisseria gonorrhoeae, Staphylococcus aureus, Pseudomonas aeruginosa, Enterobacteriaceae spp, Enterococcus faecium, Escherichia coli, Helicobacter pylori, Campylobacter spp, Salmonella spp, Streptococcus pneumoniae, Haemophilus influenzae, Shigella spp, SARS-CoV-2, SARS-CoV-1, MERS, Hepatitis B virus, Hepatitis C virus, HIV, Ebola virus, Any, Klebsiella pneumoniae, plus gut microbiome organisms (Akkermansia muciniphila, Bacteroides spp, Bifidobacterium spp, etc.)

## run_columns.csv Format

```csv
name,type,direction,description
score,float,high,Predicted probability of bioactivity
```

- **type**: float, integer, string, other
- **direction**: high (higher is better), low (lower is better), or empty (no directionality)
- One row per output column

## Example Files

### run_input.csv
Always 3 representative SMILES with header `smiles`:
```csv
smiles
CC(=O)Oc1ccccc1C(=O)O
CC(C)Cc1ccc(cc1)C(C)C(=O)O
Cn1c(=O)c2c(ncn2C)n(c1=O)C
```
These are aspirin, ibuprofen, and caffeine — safe defaults when the model accepts generic small molecules.

### run_output.csv
Matching 3 rows of output (no header smiles column, just prediction columns):
```csv
score
0.85
0.42
0.13
```
